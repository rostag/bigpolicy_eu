<!-- Usage: <app-task-list title="Given title" [project]="project" [pageSize]="10" dbQuery="{}"></app-task-list> -->

<mat-card-content>
  <mat-card-actions>
    <mat-toolbar class="add-toolbar" color="primary"><span *ngIf="title !== ''">{{title}} <span>[{{itemsPage.total}}]</span></span>
      <span class="add-fill-remaining"></span>

      <span *ngIf="!isAddingTaskMode">
        <button mat-icon-button (click)="switchTasksView()" *ngIf="compactTasksView" matTooltip="Розгорнути усі заходи" ><mat-icon>view_stream</mat-icon></button>
        <button mat-icon-button (click)="switchTasksView()" *ngIf="!compactTasksView" matTooltip="Згорнути усі заходи" ><mat-icon>view_headlines</mat-icon></button>
        <button mat-icon-button (click)="addTask(project)" *ngIf="userService.hasEditPermissions(project)" color="accent" matTooltip="Додати захід"><mat-icon>add_circle</mat-icon></button>
      </span>
    </mat-toolbar>
  </mat-card-actions>

  <!-- Add task -->
  <app-bp-task-edit
    [projectId]="project._id"
    *ngIf="isAddingTaskMode"
    (onCancelEdit)="onCancelTaskEdit($event)">
  </app-bp-task-edit>

  <ol *ngIf="!isAddingTaskMode" class="task-list">
    <li *ngFor="let task of itemsPage.docs | async | paginate: {
        id: 'taskItemsPage',
        itemsPerPage: this.pageSize,
        currentPage: itemsPage.page,
        totalItems: itemsPage.total
      }">
      <app-task-view 
        [task]="task"
        [compactView]="compactTasksView"
        [showProjectLink]="showProjectLink"
        class="task-list-item"
        dataprovided="true"
        >
      </app-task-view>
    </li>
  </ol>

  <!-- <mat-list>
     <mat-list-item *ngFor="let task of itemsPage.docs | async | paginate: {
                                                                 id: 'taskItemsPage',
                                                                 itemsPerPage: this.pageSize,
                                                                 currentPage: itemsPage.page,
                                                                 totalItems: itemsPage.total
                                                               }">


       <h3 matLine><a [routerLink]="['/task/' + task._id]"><b>{{task.title}}</b></a></h3>
       <p matLine>
        <b>{{task.cost}} UAH.</b> {{task.dateStarted | date}} - {{task.dateEnded | date}}
       </p>
       <p matLine>
         <small>{{task.project}}</small> | <small>{{task.description}}</small>
       </p>
       <div *ngIf="userService.hasEditPermissions(task)" class="admin" style="min-width:4em;">
         <a [routerLink]="['/task/' + task._id + '/edit']"><mat-icon>edit</mat-icon></a>
         <a href (click)="deleteTask(task)"><mat-icon>delete</mat-icon></a>
       </div>
    </mat-list-item>
  </mat-list> -->

  <pagination-controls
                      id = "taskItemsPage"
                      (pageChange)="pageChanged($event)"
                      [maxSize]="5"
                      directionLinks="true"
                      autoHide="true"
                      >
  </pagination-controls>

</mat-card-content>
